---
title: "Assignment2"
author: "Ted Ladas - s2124289"
date: "30/03/2021"
output: html_document
---

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE)
library(rjags)
library(INLA)
library(dplyr)
library(data.table)
library(ggplot2)
library(ggcorrplot)
library(gridExtra)
```

```{r 1.a(i)}
load(file='./earthScot.RData')
earthQ <- data.table(earthQ)

# EDA
numcols <- sapply(earthQ, is.numeric) 
cor.earthQ <- cor(earthQ, use="pairwise.complete")
ggcorrplot(cor.earthQ,
           hc.order=TRUE,
           type="lower",
           lab=TRUE)

earthQ %>% 
  filter(!is.na(`nrUK>4.5`)) %>%
  ggplot(aes(dist, eartScot,
             size=MLrUK,
             color=`nrUK>4.5`)) +
  geom_point() +
  geom_smooth(method="lm",
              formula='y~x',
              se=FALSE)

earthQ %>% 
  filter(!is.na(`nrUK>4.5`)) %>%
  ggplot(aes(decade, eartScot,
             size=MLrUK,
             color=`nrUK>4.5`)) +
  geom_point() +
  geom_smooth(method="lm",
              formula='y~x',
              se=FALSE)

earthQ %>% 
  filter(!is.na(`nrUK>4.5`)) %>%
  ggplot(., aes(eartrUK, eartScot,
                size=MLrUK,
                color=`nrUK>4.5`)) +
  geom_point() +
  geom_smooth(method="lm",
              formula='y~x',
              se=FALSE)

```

```{r 1.a(ii)}

a1 <- glm(eartScot~eartrUK, data=earthQ, family=poisson(link = "log"))
summary(a1)

earthQ %>% 
  ggplot(., aes(eartrUK, eartScot)) +
  geom_point(size=3) +
  geom_smooth(method="glm",
              formula='y~x',
              method.args=list(family=poisson(link="log")),
              se=T,
              aes(color="red4"), linetype="dashed") +
  labs(title = "Poisson Regression",
       subtitle = NULL,
       caption = NULL,
       tag = NULL,
       #x = NULL,
       #y = NULL,
       colour = "Regression") +
  theme_minimal()

# coefficients of regression after unlinking
a1.coef.unlinked <- a1 %>% coef() %>% exp()
# earthquakes during 70s and 80s
a1.fited <- a1 %>% predict(., type="response")
earthquakes.70.80 <- NULL
earthquakes.70.80 <- cbind(c(1970,1980),a1.fited[7:8])

a1.coef.unlinked
earthquakes.70.80


earthQ %>%
  dplyr::select(eartScot,eartrUK, decade) %>%
  mutate(eartScot.pred.a1 = a1.fited) %>%
  ggplot() +
  geom_point(aes(x=decade, y=eartScot, color='Actual')) +
  geom_line(aes(x=decade, y=eartScot, color='Actual')) +
  geom_point(aes(x=decade, y=eartScot.pred.a1, color='a1 Prediction')) +
  geom_line(aes(x=decade, y=eartScot.pred.a1, color='a1 Prediction')) +
  labs(title="GLM fit predictions",
       color=NULL) +
  theme_minimal()

```


```{r 1.b}



```


```{r 1.c}
```


```{r 1.d}
```


```{r 1.e}
```

```{r 2.a}
```


```{r 2.b}
```


```{r 2.c}
```


```{r 2.d}
```


```{r 2.e}
```



